#!/bin/sh

touch AUTHORS COPYING

if which glibtoolize > /dev/null 2>&1; then
    glibtoolize --automake -f -c
else
    libtoolize --automake -f -c
fi
aclocal
autoheader
if [ "$1" = "--dist" ]; then
    shift 1
    automake -a -c -f -i
else
    automake -a -c -f
fi
autoconf

HERE="$PWD"

if [ -d "$HOME/Products" ]; then
    projdir="$HOME/Products/$(basename $HERE)"
    if [ ! -d "$projdir" ]; then
	mkdir -p "$projdir"
    fi
    cd "$projdir" || (echo "Cannot change to $projdir"; exit 1)
fi

INCDIRS="-I/opt/local/include -I/usr/local/include -I/usr/include/httpd/xml"
#INCDIRS="$INCDIRS -I/sw/include/libofx"
INCDIRS="$INCDIRS -I/usr/include/python2.3"
INCDIRS="$INCDIRS -Wno-long-double"
LIBDIRS="-L/opt/local/lib -L/usr/local/lib"

if [ "$1" = "--debug" ]; then
    shift 1
    $HERE/configure CPPFLAGS="$INCDIRS" LDFLAGS="$LIBDIRS" CXXFLAGS="-g" \
	--enable-debug --enable-python "$@"
elif [ "$1" = "--opt" ]; then
    shift 1
    $HERE/configure CPPFLAGS="$INCDIRS" LDFLAGS="$LIBDIRS" \
	CXXFLAGS="-fomit-frame-pointer -O3 -mcpu=7450 -fPIC" "$@"
elif [ "$1" = "--flat-opt" ]; then
    shift 1
    $HERE/configure CPPFLAGS="$INCDIRS" LDFLAGS="$LIBDIRS" \
	CXXFLAGS="-fomit-frame-pointer -O3 -mcpu=7450" "$@"
elif [ "$1" = "--safe-opt" ]; then
    shift 1
    $HERE/configure CPPFLAGS="$INCDIRS" LDFLAGS="$LIBDIRS" \
	CXXFLAGS="-fomit-frame-pointer -O3 -mcpu=7450 -fPIC -DDEBUG_LEVEL=1" "$@"
elif [ "$1" = "--perf" ]; then
    shift 1
    $HERE/configure CPPFLAGS="$INCDIRS" LDFLAGS="$LIBDIRS" CXXFLAGS="-g -pg" "$@"
elif [ "$1" = "--python" ]; then
    shift 1
    $HERE/configure CPPFLAGS="$INCDIRS" LDFLAGS="$LIBDIRS" CXXFLAGS="-g" \
	--enable-python "$@"
else
    shift 1
    $HERE/configure CPPFLAGS="$INCDIRS" LDFLAGS="$LIBDIRS" CXXFLAGS="-g" "$@"
fi

rm -f AUTHORS COPYING
