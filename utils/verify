#!/bin/sh

TMPDIR=/tmp
if [ -d /Volumes/RamDisk ]; then
    TMPDIR=/Volumes/RamDisk
fi

rsync -Lav --delete --delete-excluded \
    --exclude="autom4te.cache/" \
    --exclude=".libs/"	  \
    --exclude="build/"	  \
    --exclude="CVS/"	  \
    --exclude="branches/" \
    --exclude="*.[oa]"	  \
    --exclude="*.l[oa]"   \
    --exclude="*.so"	  \
    --exclude="ledger"	  \
    --exclude="*~"	  \
    --exclude="_darcs/"   \
    --exclude="scripts/"  \
    ./ $TMPDIR/ledger-verify/

cd $TMPDIR/ledger-verify
make all-clean
./acprep --safe-opt

if make ledger; then
   strip ledger
   nice -n 20 utils/tests
fi
