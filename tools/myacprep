#!/bin/sh

OUTPUT=$(tools/outdir)
PRODUCTS=$(dirname "$OUTPUT")
SWITCHES="--pch --warn --devel --debug"

while [ -n "$1" ]; do
  case "$1" in
    --local)
      SWITCHES="$SWITCHES --local"
      shift 1 ;;
    --output)
      shift 1
      SWITCHES="$SWITCHES --output $1"
      shift 1 ;;
    --gprof)
      SWITCHES="$1 --release --pch"
      SWITCHES="$SWITCHES --output $PRODUCTS/ledger-gprof"
      shift 1 ;;
    --gcov)
      SWITCHES="$1 --release --pch"
      SWITCHES="$SWITCHES --output $PRODUCTS/ledger-gcov"
      shift 1 ;;
    --opt)
      SWITCHES="$1 --release --pch --warn"
      SWITCHES="$SWITCHES --output $PRODUCTS/ledger-opt"
      shift 1 ;;
    --debug)
      SWITCHES="$1 --pch --warn --devel"
      SWITCHES="$SWITCHES --output $PRODUCTS/ledger-debug"
      shift 1 ;;
    --std)
      SWITCHES="--release --pch --warn"
      SWITCHES="$SWITCHES --output $PRODUCTS/ledger-std"
      shift 1 ;;
    *)
      SWITCHES="$SWITCHES $1"
      shift 1 ;;
  esac
done

if [ -n "$OUTPUT" ]; then
    if echo "$SWITCHES" | egrep -qv '(output|local)'; then
	SWITCHES="$SWITCHES --output $OUTPUT"
    fi
fi

./acprep $SWITCHES
