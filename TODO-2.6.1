LEDGER  -*- mode: org; fill-column: 78 -*-

#+STARTUP: content fninline hidestars
#+SEQ_TODO: STARTED TODO(@) WAITING(@) DELEGATED(@) DEFERRED(@) | DONE(@) CANCELED(@) WONTFIX(@) WORKSFORME(@) INVALID(@) DUPLICATE(@) CLOSED TESTED NOTE
#+TAGS: blocker(B) critical(C)
#+DRAWERS: PROPERTIES LOGBOOK OUTPUT SCRIPT SOURCE DATA
#+LINK: bug http://newartisans.com/bugzilla/show_bug.cgi?id=
#+CATEGORY: Ledger

* Bugs
** DONE [#A] -p "this month" doesn't work at all anymore                                 :ATTACH:
   - State "DONE"       [2008-07-17 Thu 18:14] \\
     This has been fixed, and represents a very major set of fixes to date
     handling in general.  Thanks to Nathan for hitting the nail on the head.
   - State "TODO"       [2008-04-05 Sat 18:57] \\
     Nathan Jones <nathanj@insightbb.com> writes:
     > The patch fixes a command that I have aliased to show my last two months
     > of posts: `ledger -d 'd>=[last month]' reg checking`
     >
     > The problem is that the 'last month' would get parsed as 1970/1/1, so it
     > would show every xact.
   :OUTPUT:
   ~ $ DEBUG_CLASS=ledger.config.predicates *ledger -p "this month" reg cash
   Predicate: d>=[1969/12/31]&d<[1970/01/31]&/(?:cash)/
   :END:
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   38
   :Attachments: 289.patch
   :ID:       0CF00621-31C4-4E5A-B260-78B4DA8C3616
   :CREATED:  [2008-04-04 Fri]
   :END:
** DONE [#A] Cannot sort by reverse time
   - State "DONE"       [2008-07-19 Sat 16:52]
   When I specify `--sort -d`, I get:
   :OUTPUT:
   ~/src/ledger $ ledger -b 2008/07 --sort -d reg cash
   While computing value expression:
   -date
   ^^^^^
   Error: Cannot negate a date/time
   :END:
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6.0.90
   :Ticket:   202
   :ID:       CB97253A-581E-49D0-98D4-3BC5B0616A42
   :CREATED:  [2008-07-17 Thu]
   :END:
** DONE [#A] Core dump on simple input.
   - State "DONE"       [2008-07-17 Thu 17:38]
   :DATA:
   2008/01/03=2007/12/28 * Sell -- RHT -- RED HAT INC CA TAUX DE CHANGE    .96590
   Assets:Investments:RBC-Broker:Account-RSP      -4.00 RHT @  21.14 CAD
   Expenses:Financial:Commissions                  9.95 USD @ .96590 CAD
   Assets:Investments:RBC-Broker:Account-RSP      72.06 CAD
   :END:
   :PROPERTIES:
   :Submitter: Martin Blais <blais@furius.ca>
   :Version:  2.6
   :Ticket:   56
   :ID:       843B6A53-C3C2-45BB-A92C-558AF6F02014
   :CREATED:  [2008-04-07 Mon]
   :END:
** DONE [#A] crash
   - State "DONE"       [2008-07-17 Thu 17:39]
   :DATA:
   2007-12-31 * Start of year / Opening balances.
   Assets:Investments:HSBC-Broker             1000 USD @ 101.00 JPY
   Equity:Opening-Balances:Cost              -1000 USD
   :END:
   :PROPERTIES:
   :Submitter: Martin Blais <blais@furius.ca>
   :Version:  2.6
   :Ticket:   177
   :ID:       45605775-F9E3-4C83-8BF2-616905178E82
   :CREATED:  [2008-04-12 Sat]
   :END:
** DONE [#A] Crash on input.
   - State "DONE"       [2008-07-17 Thu 17:38]
   - State "TODO"       [2008-04-06 Sun 10:23] \\
     Martin Blais <blais@furius.ca> writes:
     > I think that the bug is related to the missing currency after the @
     > sign.
   :DATA:
   ;; Assets:Investments:HSBC-Broker ------------------------------------------------------------

   2007/12/31 * Start of year / Opening balances.
   Assets:Investments:HSBC-Broker             100 IVV
   Assets:Investments:HSBC-Broker       -15360.60 USD    ; cost basis of older purchase
   Equity:Opening-Balances

   2008/01/03 * Dividends received for IVV holding.
   Assets:Investments:HSBC-Broker            79.79 USD
   Income:Interest:Dividends


   2008/02/04 * Sell 100 IVV - on 2008/01/30
   Assets:Investments:HSBC-Broker            -100 IVV @ 136.2901
   Assets:Investments:HSBC-Broker       -13629.01 USD
   Expenses:Financial:Commissions           24.99 USD
   Expenses:Financial:Fees                   0.15 USD
   Expenses:Financial:Fees                   2.00 USD
   :END:
   :OUTPUT:
   banane:~/__accounting/.../rbcinv/invest$ ledger -f /tmp/b -V register hsbc:broker
   Segmentation fault (core dumped)
   banane:~/__accounting/.../rbcinv/invest$
   :END:
   :PROPERTIES:
   :Submitter: Martin Blais <blais@furius.ca>
   :Version:  2.6
   :Ticket:   46
   :ID:       703505C9-B702-4139-B64A-FD3CF592E720
   :CREATED:  [2008-04-06 Sun]
   :END:
** DONE [#A] Crash on input.
   - State "DONE"       [2008-07-17 Thu 17:38]
   :DATA:
   2008/01/02 ! Sell -- on 2007/12/27 -- CRA  --  APPLERA CORP COM CELERA GROUP CA EXCHANGE RATE     .96760
   Assets:Investments:RBC-Broker:Account-CAD   -8.00 CRA  @ 16.93 USD
   Assets:Investments:RBC-Broker:Account-CAD  121.41 CAD
   Expenses:Financial:Commissions              -9.95 USD
   Expenses:Financial:Fees                     -0.01 USD
   :END:
   :PROPERTIES:
   :Submitter: Martin Blais <blais@furius.ca>
   :Version:  2.6
   :Ticket:   47
   :ID:       B2B79746-5E3B-40D3-B6ED-CCF27364DD5F
   :CREATED:  [2008-04-06 Sun]
   :END:
** DONE [#A] Dates (used with -b -e and -p parameters) are broken                        :ATTACH:
   - State "DONE"       [2008-07-17 Thu 06:20] \\
     Patch checked in.  Thanks, Nathan!
   - State "TODO"       [2008-04-06 Sun 21:59] \\
     Nathan Jones <nathanj@insightbb.com> writes:
     > The attached patch plus the one in #38 should fix this.
   The release (2.6.0.90) doesn't seem to properly parse dates.  The svn
   version (rev. 1048) works fine for full dates (yyyy/mm/dd) with the -b -e
   params but nothing else works.  For example in the following only the last
   one works:
   :SCRIPT:
   ledger -f my.ledger -b mar -e apr print
   ledger -f my.ledger -b 03/01 -e -04/01 apr print
   ledger -f my.ledger -b 03/01 -e 04/01 print
   ledger -f my.ledger -b 08/03/01 -e 08/04/01 print
   ledger -f my.ledger -b 2008/03/01 -e 2008/04/01 print
   :END:
   The -p param doesn't seem to work at all.
   :PROPERTIES:
   :Submitter: kmt <kmt@ftml.net>
   :Version:  2.6.0.90
   :Ticket:   49
   :Attachments: 290.patch
   :ID:       A95B2E0F-095D-4314-BC4D-3CEC42203FB1
   :CREATED:  [2008-04-06 Sun]
   :END:
** DONE [#A] Xact command produces two liability posts
   - State "DONE"       [2008-07-17 Thu 22:01]
   - State "TODO"       [2008-05-03 Sat 22:27] \\
     This is being a real problem for drewr, arete and pll!  This one gets fixed
     for 2.6.1.
   :OUTPUT:
   arete$ ledger xact 2007/11/11 safeway groceries \$10.00 american

   2007/11/11   Safeway
        Expenses:Groceries                                $10.00
        Liabilities:American Express                     $-30.17
        Liabilities:American Express                      $20.17
   :END:
   :PROPERTIES:
   :Submitter: Will Glozer <will@glozer.net>
   :Version:  2.6
   :Ticket:   8
   :ID:       D7DD54D7-8870-4D6D-92A0-90717692F8F2
   :CREATED:  [2007-11-12 Mon]
   :END:
** DONE [#A] ledger 2.6 shows no timelog posts
   - State "DONE"       [2008-07-17 Thu 19:08]
   - State "TODO"       [2008-08-18 Mon 02:15] \\
     Simon Michael <simon@joyful.com> writes:
     > And if ends with a "i" record, ledger gives a bus error. This is on
     > leopard.
   Ledger 2.5 shows posts in my timelog file, but 2.6.1-pre shows none. There
   is no parse error.
   :PROPERTIES:
   :Submitter: Simon Michael <simon@joyful.com>
   :Version:  2.6.1b
   :Ticket:   57
   :ID:       C13F0BDF-4E15-442E-BBB7-265B0A37457C
   :CREATED:  [2008-04-09 Wed]
   :END:
** DONE [#A] Make -e use an inclusive end date, and -E an exclusive one
   - State "DONE"       [2008-07-17 Thu 06:22] \\
     -e has been reverted back to its old behavior, to avoid confusing people.
   Right now (as of today) -e was made exclusive, but this isn't right; I need
   another option for exclusivity.
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   37
   :ID:       A440BB5E-072B-4C75-A235-C551EA090F81
   :CREATED:  [2008-04-04 Fri]
   :END:
** DONE [#A] Strip \r from lines when parsing on Windows
   - State "DONE"       [2008-07-17 Thu 18:31]
   It sounds like I'm not stripping the \r from the \r\n sequence, and thus
   it's interpreting the \r as part of the file name. I'll add this to the
   buglist for 3.0.
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   43
   :ID:       458B2B74-AF2D-4D9D-89E4-D8AC26CFD531
   :CREATED:  [2008-04-05 Sat]
   :END:
** DONE [#A] trailing whitespace is significant in 2.6                                   :ATTACH:
   - State "DONE"       [2008-04-05 Sat 18:56] \\
     The first patch fixes parsing account names when a single space follows.
     This might close ticket #3.
   - State "TODO"       [2008-04-05 Sat 18:55] \\
     The following patch, submitted by Nathan Jones, proposes to fix this problem.
   - State "TODO"       [2007-09-22 Sat 04:26] \\
     Simon, have you tried this with 2.6.1-svn?  I believe this is something I
     fixed.
   Unlike 2.5, 2.6 considers an account name followed by whitespace to be
   different from one without (when no amount is specified).
   :PROPERTIES:
   :Submitter: Simon Michael <simon@joyful.com>
   :Version:  2.6
   :Ticket:   3
   :Attachments: 288.patch
   :ID:       FB2330E1-AD78-4559-A885-A488DFDF3DC1
   :CREATED:  [2007-09-22 Sat]
   :END:
** DONE -e doesn't seem to work for providing an end date
   - State "DONE"       [2008-04-04 Fri 14:34] \\
     There was a problem with the -e date parsing.  I now interpret "-e june"
     to mean that you want the report to end AT June, rather than IN June.
   :DATA:
   2008/03/20 Grocery Store
   Travel:Home               2.3 miles
   Wear & Tear:Car

   2008/03/31 Office
   Travel:Work               16 miles
   Wear & Tear:Car

   2008/04/01 Office
   Travel:Work               16 miles
   Wear & Tear:Car

   2008/04/02 Office
   Travel:Work               16 miles
   Wear & Tear:Car

   2008/04/03 Office
   Travel:Work               16 miles
   Wear & Tear:Car

   2008/04/04 Office
   Travel:Work               16 miles
   Wear & Tear:Car
   :END:
   :OUTPUT:
   $ ledger -f /tmp/mileage.ledger -b 2008-03-31 reg travel
   2008/03/31 Office               Travel:Work              16.7 miles   16.7 miles
   2008/04/01 Office               Travel:Work              16.7 miles   33.4 miles
   2008/04/02 Office               Travel:Work              16.7 miles   50.1 miles
   2008/04/03 Office               Travel:Work              16.7 miles   66.8 miles
   2008/04/04 Office               Travel:Work              16.7 miles   83.5 miles
   $ ledger -f /tmp/mileage.ledger -b 2008-03-31 -e 2008-04-05 reg travel
   $
   :END:
   Shouldn't that last command give me the same output as the former?
   :PROPERTIES:
   :Submitter: drewr <#ledger>
   :Version:  2.6
   :Ticket:   36
   :ID:       1DE6FB08-93D2-47C8-A5A3-3379BA76360D
   :CREATED:  [2008-04-04 Fri]
   :END:
** DONE Command results in assertion failure
   - State "DONE"       [2008-07-17 Thu 17:44]
   The command is:
   :SCRIPT:
   ledger -s bal --sort O wedding
   :END:
   This is against my own ledger file.
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   23
   :ID:       AB684BBE-F093-4F77-BCFB-2F4E0D60AA9C
   :CREATED:  [2007-12-10 Mon]
   :END:
** DONE Coredump.
   - State "DONE"       [2008-07-17 Thu 17:50]
   :DATA:
   2008/01/02 * Sell -- on 2007/12/27 -- CRA  --  APPLERA CORP COM CELERA GROUP CA EXCHANGE RATE     .96760
   Assets:Investments:RBC-Broker:Account-CAD        -8.00 CRA @ 16.93 USD      ; lot:ba8c951719fd
   Expenses:Financial:Commissions                    9.95 USD
   Expenses:Financial:Fees                           0.01 USD
   Assets:Investments:RBC-Broker:Account-CAD       125.48 USD
   Assets:Investments:RBC-Broker:Account-CAD      -125.48 USD ; @ 0.96760 USD
   Assets:Investments:RBC-Broker:Account-CAD       121.41 CAD
   :END:
   :PROPERTIES:
   :Submitter: Martin Blais <blais@furius.ca>
   :Version:  2.6
   :Ticket:   50
   :ID:       A18B37A4-68DB-4F3A-92D5-3962D010CA0B
   :CREATED:  [2008-04-06 Sun]
   :END:
** DONE Crash on input -- spurious comma
   - State "DONE"       [2008-07-17 Thu 17:49]
   :DATA:
   2008/02/25 * bla bla bnla
   Assets:Fixed:Home                             235000.00 CAD
   Expenses:Home:Acquisition:Escrow              -82250.00 CAD
   Liabilities:RBC:Mortgage:Loan                     -1.00 CAD,  ; opening of account
   Liabilities:RBC:Mortgage:Loan                -152749.00 CAD
   :END:
   :PROPERTIES:
   :Submitter: Martin Blais <blais@furius.ca>
   :Version:  2.6
   :Ticket:   48
   :ID:       517CB118-49A5-42B2-ACFD-1A63DCF163AA
   :CREATED:  [2008-04-06 Sun]
   :END:
** DONE Crash on input.
   - State "DONE"       [2008-07-17 Thu 17:45]
   :DATA:
   2008/01/02 ! Sell -- on 2007/12/27 -- CRA  --  APPLERA CORP COM CELERA GROUP CA EXCHANGE RATE     .96760
   Assets:Investments:RBC-Broker:Account-CAD    -8.00 CRA  @ 16.93 USD
   Assets:Investments:RBC-Broker:Account-CAD    21.41 CAD
   Expenses:Financial:Commissions               -9.95 USD
   Expenses:Financial:Fees                      -0.01 USD
   :END:
   :PROPERTIES:
   :Submitter: Martin Blais <blais@furius.ca>
   :Version:  2.6
   :Ticket:   45
   :ID:       93CFAFEB-46EA-4E47-8F0A-069309D6EE3A
   :CREATED:  [2008-04-06 Sun]
   :END:
** DONE Crash reading .timelog file
   - State "DONE"       [2008-07-17 Thu 18:08]
   2.6b aborts if the last xact is the timelog is an "in" event.
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   128
   :ID:       C7A32276-11A7-44F1-99CD-6F0CA7330340
   :CREATED:  [2008-04-11 Fri]
   :END:
** DONE Do not adjust display precision when parsing a pricing xact
   - State "DONE"       [2008-09-17 Wed 05:12]
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6.0.90
   :Ticket:   206
   :ID:       7E5D2A6C-A15F-4BC8-A851-04A48E3E30F4
   :CREATED:  [2008-07-28 Mon]
   :END:
** DONE Expressions don't work.
   - State "DONE"       [2008-07-17 Thu 21:37]
   - State "TODO"       [2008-04-12 Sat 14:58] \\
     Martin Blais <blais@furius.ca> writes:
     > Note the typo in the error too: "evalute" -> "evaluate".
   :DATA:
   2007-12-31 * Start of year / Opening balances.
   Assets:Investments:HSBC-Broker             1000 USD
   Equity:Opening-Balances:Cost            -101000 JPY @ 1/101.00 USD
   :END:
   :PROPERTIES:
   :Submitter: Martin Blais <blais@furius.ca>
   :Version:  2.6
   :Ticket:   178
   :ID:       DA9F2346-CD90-4E22-B2F0-2670532456BA
   :CREATED:  [2008-04-12 Sat]
   :END:
** DONE Getting an abort with a self-referential pricing statement
   - State "DONE"       [2008-07-17 Thu 17:51] \\
     Getting this to work correctly is going to need more work (which has already
     been logged as another bug).
   :DATA:
   2008/01/02 sell
   Assets:Investments      130.41 CAD @ 1.03352277 CAD
   Assets:Investments       -8.00 CRA @ 16.93 USD
   :END:
   Passing this through the reg command produces a SIGABRT.
   :PROPERTIES:
   :Submitter: Martin Blais <blais@furius.ca>
   :Version:  2.6
   :Ticket:   51
   :ID:       A21E4DCC-6112-441F-B76D-95CF47BA658D
   :CREATED:  [2008-04-06 Sun]
   :END:
** DONE Ignore [TEXT] in a xact which does not specify a date
   - State "DONE"       [2008-09-17 Wed 05:10] \\
     Fixed, by simply ignoring when something that looks [TEXT] in a xact
     note fails to parse as a date.
   The following data contains a link, not an effective date.
   :DATA:
   2008/08/11 (08/13/2008) DD/BR #337756      Q35 TONAWANDA, NY
    Liabilities:Visa                          -3.63
    Assets:Company:AGIL1892     ; /PersMealsBreakf/ [[file:///home/rladams/doc/Album/Receipts/20080815131347.jpg]]
   :END:
   :PROPERTIES:
   :ID:       96DDA4B9-E216-4C7A-8D0E-02B0F39CA256
   :CREATED:  [2008-08-27 Wed]
   :END:
** DONE Install patches for Ledger 2.6 from Simon Michael                                :ATTACH:
   - State "DONE"       [2008-07-17 Thu 21:41] \\
     I'm only taking the first patch for 2.6.  The other two need a bit more
     polish before I would put them in the standard distro, instead of just
     posting them to the Wiki or some such.
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   60
   :ID:       0C311A59-701A-4D30-BBDB-924F12878724
   :Attachments: sm001.patch sm002.patch sm004.patch
   :CREATED:  [2008-04-11 Fri]
   :END:
** DONE ledger SVN doesn't compile on freebsd-8
   - State "DONE"       [2008-03-17 Mon 16:22] \\
     Clemens writes:
     > Just for the record, there's a fix:
     :PATCH:
   - State "DONE"       [2008-03-14 Fri 21:32] \\
     This is a known bug that was fixed in 2.6.  If you need a back-patch for
     2.4.1, please let me know.
   diff --git a/ledger-2.6.0.90/datetime.h b/ledger-2.6.0.90/datetime.h
   --- a/ledger-2.6.0.90/datetime.h
   +++ b/ledger-2.6.0.90/datetime.h
   @@ -96,7 +96,7 @@ class date_t
   operator bool() const {
     return when != 0;
   }
   -  operator std::time_t() const {
   +  operator std::time_t() /*const*/ {
     return when;
   }
   operator std::string() const {
     :END:
     > Let's you compile and install.
   We have ledger-2.4 in the ports, but it segfaults on freebsd-8 (the current
   dev version of the OS).  The backtrace is incoherent, because the libs are
   stripped and we have no symbols.  Anyway, a sane person would want a more
   recent ledger.  The tarball exhibits the exact same problem as the one from
   SVN:
   :OUTPUT:
   'uname -rims' -> FreeBSD 8.0-CURRENT i386 GENERIC
   'gcc --version' -> gcc (GCC) 4.2.1 20070719  [FreeBSD]

   /src/bulk/ledger/trunk
   0 $ gmake
   gmake  all-am
   gmake[1]: Entering directory `/home/src/bulk/ledger/trunk'
   /usr/local/bin/bash ./libtool --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I.   -I/l/include   -g -O2 -c -o libamounts_la-amount.lo `test -f 'amount.cc' || echo './'`amount.cc
   g++ -DHAVE_CONFIG_H -I. -I/l/include -g -O2 -c amount.cc  -fPIC -DPIC -o .libs/libamounts_la-amount.o
   In file included from amount.h:13,
                 from amount.cc:1:
   datetime.h: In function 'long int operator-(const date_t&, const date_t&)':
   datetime.h:141: error: conversion from 'date_t' to 'long int' is ambiguous
   datetime.h:99: note: candidates are: date_t::operator time_t() const
   datetime.h:96: note:                 date_t::operator bool() const
   gmake[1]: *** [libamounts_la-amount.lo] Error 1
   gmake[1]: Leaving directory `/home/src/bulk/ledger/trunk'
   gmake: *** [all] Error 2
   :END:

   I know C and i can do some gdb(1), but i don't have the C++ knowledge to
   even fix this one.  It looks not all that complicated.  Maybe a little patch
   could help the C++ compiler to figure out the type inference.

   I used emacs for quite some time, but got annoyed with its ancient lisp.  So
   using the common lisp version is currently not an option for me, and without
   emacs one has to type way to much for some little reports.  Could you please
   bring the C++ version into a usable state again?  perhaps it's not that much
   work?
   :PROPERTIES:
   :Submitter: Clemens <finetouch>
   :Version:  2.4.1
   :Ticket:   34
   :ID:       C1BE11BD-958D-4E67-8B85-5DA14CD375B4
   :CREATED:  [2008-03-14 Fri]
   :END:
** DONE Segmentation fault on import from GnuCash                                        :ATTACH:
   - State "DONE"       [2008-07-17 Thu 20:04]
   - State "TODO"       [2008-06-16 Mon 16:05] \\
     Luben Manolov <lubo@manolov.org> writes:
     > Import of this GnuCash file causes Segmentation fault
   I am trying to import a simple GnuCash file and I am getting "Segmentation
   fault" error. Please find attached the sample file.
   :OUTPUT:
   ./ledger -f sample.gnucash balance
   While balancing xact:
   2008/06/16
      Segmentation fault
   :END:
   :PROPERTIES:
   :Submitter: Luben Manolov <lubo@manolov.org>
   :Version:  2.6
   :Ticket:   198
   :ID:       266D96D2-DEB5-4BD9-A51B-B2F652E2F550
   :Attachments: sample.gnucash
   :CREATED:  [2008-06-16 Mon]
   :END:
** DONE Unbalanced posts due to rounding problems
   - State "DONE"       [2008-09-17 Wed 05:03] \\
     The cents disappeared because 'D $1,000.00' must be specified at the beginning
     of the file, since you never use dollar figures outside of the pricing.

     The extra penny crept in because of the way that commodity have "lot" details
     automatically associated with them.  I've now reduced this to the price only,
     since that's what most people are likely to use, just as this example does.
   - State "TODO"       [2008-08-01 Fri 13:34] \\
     Levin <zslevin@gmail.com> writes:
     > This is the result of ledger in git master branch:
     :OUTPUT:
   ./ledger -f test.ledger -V reg HLIT
   2008/06/01 BUY HLIT             Assets:HLIT     $750         $750
   2008/07/02 SELL HLIT          Assets:HLIT      $-658            0
                                 Assets:HLIT    $658         $658
                            Assets:HLIT        $-658            0
     :END:
     > I wonder why .xxx is vanished :)
   I found some more rounding problems now that I've upgraded to 2.6.1. These
   posts balanced in version 2.5.
   :DATA:
   2008/06/01 BUY HLIT
    Assets:HLIT   15 HLIT @ $50.00
    Assets

   2008/07/02 SELL HLIT
    Assets:HLIT   -15 HLIT @ $50.00
    Assets:HLIT    15 HLIT @ $43.875
    Assets:HLIT   -15 HLIT @ $43.875
    Assets
   :END:
   :OUTPUT:
   [20:30:53 vinod]:~/data $ ledger -V reg HLIT
   2008/06/01 BUY HLIT             Assets:HLIT  $750.00      $750.00
   2008/07/02 SELL HLIT            Assets:HLIT $-658.12        $0.01
                                Assets:HLIT  $658.13      $658.14
                                Assets:HLIT $-658.12        $0.01
   :END:
   So, I end up with an extra penny. I think it's because 658.125 rounds down
   on one xact and rounds up on the other.
   :PROPERTIES:
   :Submitter: Vinod Kurup <vvkurup@gmail.com>
   :Version:  2.6.1b
   :Ticket:   207
   :ID:       E87DD3A5-B061-46A0-95E9-9844A6CB0443
   :CREATED:  [2008-08-01 Fri]
   :END:
** DONE [#C] Xact command doesn't match debit account when description is unmatched
   - State "DONE"       [2008-07-20 Sun 20:32]
   I think I've isolated a bug with the xact command where I get "Equity"
   instead of a valid debit account:
   :OUTPUT:
   $ ledger xact 2008/07/18 "Pei Wei" food 20 checking

   2008/07/18 Pei Wei
    Expenses:Food:Out                        $ 20.00
    Assets:Checking

   $ ledger xact 2008/07/18 "Foo Bar" food 20 checking

   2008/07/18 Foo Bar
    Expenses:Food                            $ 20.00
    Equity
   :END:

   The first command proves that ledger understands I have an `Assets:Checking`
   account.  That's because I already have posts for `Pei Wei`.

   If I enter a description that doesn't match a previous xact, it doesn't
   match `checking` to `Assets:Checking`.
   :PROPERTIES:
   :Submitter: drewr <#ledger>
   :Version:  5fbec3582319ca6423a43c9125842be5f969e8ee
   :Ticket:   203
   :ID:       FF8CE4C5-03B3-4FCA-85BD-52A9DB191B4B
   :CREATED:  [2008-07-18 Fri]
   :END:
** DONE [#C] Merge Levin's changes into v2.6.1b
   - State "DONE"       [2008-08-26 Tue 10:11]
   These are from http://github.com/levindu/ledger
   :PROPERTIES:
   :ID:       C9167249-98C3-4C7E-8076-35B81A580B38
   :CREATED:  [2008-08-21 Thu]
   :END:
** DONE [#C] Multiple commodities in gnucash crash ledger                                :ATTACH:
   - State "DONE"       [2008-07-17 Thu 21:26]
   - State "TODO"       [2008-03-27 Thu 19:54] \\
     I still have to review the patch and make the changes, before this gets
     closed.
   - State "TODO"       [2008-03-27 Thu 15:20] \\
     slanack writes:
     > The proposed Fix works for me.  The problem was that <split:quantity>
     > received the `xact commodity' instead of the correct `account
     > commodity'.  There should really be a check if the account commodity has
     > been defined.
   I am using posts between accounts with different base commodities in
   gnucash.  Ledger reports a segfault when reading the gnucash file and using
   the command `print`.
   :PROPERTIES:
   :Submitter: slanack
   :Version:  2.6.0.90
   :Ticket:   35
   :ID:       DAAF3481-1B7A-4F4A-9EC6-575104655B1B
   :Attachments: gnucash.cc.patch gnucash-minimal.xml
   :CREATED:  [2008-03-23 Sun]
   :END:
** DONE [#C] My "bal" command is broken again
   - State "DONE"       [2008-07-17 Thu 21:22]
   :OUTPUT:
   ~/Reference/Computing/Systems/Linux $ bal
        3,848.34
         EC 450.05  Assets
   Error: Cannot compare amounts with different commodities: EC and $
   :END:
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   66
   :ID:       8159EF00-B95D-4E83-9927-7DB461CD2CC9
   :CREATED:  [2008-04-11 Fri]
   :END:
** DONE [#C] Segfault with commodity price in budget.
   - State "DONE"       [2008-07-17 Thu 20:09]
   :DATA:
   ~ Monthly
   Assets:Invest    2 AAPL @ $30.00
   Assets:Bank     -2 AAPL
   :END:
   It works if the '@ $30.00' is removed. The problem is that xact is null
   when called through parse_posts. Backtrace:
   :OUTPUT:
   #0  0x080632ab in datetime_t (this=0xbfb4af88, _when=@0x40) at datetime.h:173
   #1  0x080973ac in ledger::xact_t::actual_date (this=0x0) at journal.h:180
   #2  0x080b7fc7 in ledger::parse_xact (
    line=0x8119e20 "  Assets:Invest    2 AAPL @ $30.00", account=0x813be00,
    xact=0x0) at textual.cc:258
   #3  0x080b9480 in ledger::parse_posts (in=@0xbfb4b4bc,
    account=0x813be00, xact=@0x813e2f8, kind=@0xbfb4b2f8, beg_pos=63)
    at textual.cc:340
   ...
   :END:
   :PROPERTIES:
   :Submitter: Nathan Jones <nathanj@insightbb.com>
   :Version:  2.6.0.90
   :Ticket:   191
   :ID:       A4F87484-1B1D-4C76-B0AB-70E20FBA9D1B
   :CREATED:  [2008-04-23 Wed]
   :END:
** WONTFIX No commodity when amount contains simple math operation
   - State "WONTFIX"    [2007-11-09 Fri 23:34] \\
     This expected behavior.  If you multiply or divide two commoditized
     amounts together, the second commodity is dropped in favor of the first.
     You'll have to use "30 AAPL * .01".
   Use the following legder data file (sample2.dat)
   :DATA:
   2004/05/01 * Investment balance
   Assets:Brokerage              100 / 30 AAPL @ $30.00
   Equity:Opening Balances
   :END:

   Create the bal report:
   :OUTPUT:
   $ ledger -f sample2.dat bal
            3.333333  Assets
          $-99.99999  Equity
   --------------------
            3.333333
          $-99.99999
   :END:

   Notice that the "AAPL" commodity is gone.
   :PROPERTIES:
   :Submitter: Levin <zslevin@gmail.com>
   :Version:  2.6
   :Ticket:   7
   :ID:       4290A2E5-8CFB-4529-87DE-F088719AF13A
   :CREATED:  [2007-11-09 Fri]
   :END:
** WONTFIX Problem with pricing specification in prices.db file
   - State "WONTFIX"    [2008-07-17 Thu 21:42] \\
     Pricing info is not used for balancing posts.  For that, you'd need to use
     "@ ... USD" for the halfg and gouda amounts, so that Ledger could be certain
     your posts balances to zero.
   - State "TODO"       [2008-04-05 Sat 20:09] \\
     I changed it to this below, and ledger stopped complaining:
     :DATA:
   2007/03/07 Irena
    Liabilities:Cash:Irena 7.00 USD
    Liabilities:Order1:Irena -1 gouda

   2007/03/07 Irena
    Liabilities:Cash:Irena 11.00 USD
    Liabilities:Order1:Irena -4 halfg
     :END:
   :OUTPUT:
   djw@hector:~$ ledger bal

   2007/03/07 Irena
    Liabilities:Cash:Irena 18.00 USD
    Liabilities:Order1:Irena -4 halfg
    Liabilities:Order1:Irena -1 gouda
   Error: /home/djw/milk.ledger, line 106: Xact above does not balance; remainder is: 18.00 USD
   -1 gouda
   -4 halfg
   :END:
   Here is what is in the prices.db file:
   :DATA:
   C 1.00 USD = $1.21
   P 2007/03/04 00:00:00 halfg 2.75 USD
   P 2007/03/04 00:00:00 gouda 7 USD
   :END:
   So you multiply 4*2.75 and add 7, you get 18. Since the units are USD, what
   is the beef? Why isn't ledger seeing 1 gouda and 4 halfg as 18 USD?
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   42
   :ID:       43CFF7FF-DA09-478C-AED1-2D2756BACA09
   :CREATED:  [2008-04-05 Sat]
   :END:
** WONTFIX [#C] Balance calculations using the '=' operator are off
   - State "WONTFIX"    [2008-08-15 Fri 04:14] \\
     This feature is not ready for 2.6.1, and is being pushed to 3.0 where this
     issue has been fixed.
   When I run 'ledger --tail 20 reg assets:cash' with my current ledger data,
   the final balance is way, way off.  Something is being miscalculated.
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6.1b
   :Ticket:   209
   :ID:       F32E914F-D485-427B-89E9-33C762CC1A47
   :CREATED:  [2008-08-02 Sat]
   :END:
** WONTFIX [#C] Non-balanced virtual xact should fail.
   - State "WONTFIX"    [2008-07-17 Thu 20:44] \\
     This is not an error because:

     1. specifying no amount is the same as specifying an uncommoditized zero.
     2. the second line will "auto-balance" with the first line.
     3. the third line simply is a no-op, which I allow for the sake of script
        writers.

     There could be a warning for something like this, but then that's the
     danger of using () around an account name: you are explicitly stating you
     do not wish the xact to be balanced.
   - State "TODO"       [2008-04-23 Wed 13:35] \\
     Martin Blais <blais@furius.ca> writes:
     > Well... should "probably" fail. I mean, it does nothing, so it's
     > probably an error. I'd make it fail.
   Shouldn't this fail?
   :DATA:
   2004/03/25 Donations
    Assets:Checking                   $100.00
    Assets:Savings
    (Income:Donations)
   :END:
   :PROPERTIES:
   :Submitter: Martin Blais <blais@furius.ca>
   :Version:  2.6
   :Ticket:   190
   :ID:       75E83651-B130-4978-89C7-DFED4E874E8F
   :CREATED:  [2008-04-23 Wed]
   :END:
** WORKSFORME [#A] Monthly register command displays nothing
   - State "WORKSFORME" [2008-07-17 Thu 20:12] \\
     This has apparently been fixed by the recent date/time bug fixes.
   The command is:
   :SCRIPT:
   ledger -p 2005 -e 2005/08/17 --monthly reg
   :END:
   This is against my own ledger file.
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   30
   :ID:       841041A2-925D-4797-BE44-11BFC7333054
   :CREATED:  [2007-12-10 Mon]
   :END:
** WORKSFORME [#A] Weekly register report is completely broken in 2.6
   - State "WORKSFORME" [2008-07-17 Thu 20:11] \\
     This has apparently been fixed by all the other date/time fixes done today.
   The command is:
   :SCRIPT:
   ledger --weekly reg food
   :END:
   This works fine in 2.5.
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   26
   :ID:       30383931-3060-4999-8FD3-9002E02366A0
   :CREATED:  [2007-12-10 Mon]
   :END:
** WORKSFORME ledger -MA doesn't give a monthly report if some months have no posts
   - State "WORKSFORME" [2008-07-17 Thu 20:14] \\
     This works for me.
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   61
   :ID:       FD118D79-3B8F-48CE-89D0-F0FFD46F6C49
   :CREATED:  [2008-04-11 Fri]
   :END:
** WORKSFORME Problems with the prices.db file
   - State "WORKSFORME" [2008-07-17 Thu 21:45] \\
     Pricing posts must start with a capital P, not a lowercase p.
   - State "TODO"       [2008-04-05 Sat 20:06] \\
     However, even though I do not receive parse errors any longer, the
     price-db command does not work the way I expect it to. When I issue a
     'bal' option, ledger still outputs the values in their commodity rather
     than the dollar amount, so even though I am not receiving an error, it
     still does not seem to work for me.
   This bug also mentions other issues, which are now contained in another
     bug.
   My prices.db file looks like:
   :DATA:
   p 2007/01/14 02:18:01 WMCVX $5.04
   p 2007/01/14 02:18:02 WMICX $6.65
   :END:
   Notice there is no carriage return after the second line and that the file
   begins on line 1.

   When I run 'ledger --price-db prices.db bal' I get the following:
   :OUTPUT:
   Error: prices.db, line 2: Failed to parse dateP
   Error: Errors parsing file 'life/finances/ledger/prices.db'
   :END:

   If I have a carriage return on the second line, I get errors for both line 2
   and line 3. If i have one xact on a single line, I get an error for line 2.

   Any ideas?

   Also, I would like to get the prices.db perl script working to automatically
   grab the values from Fidelity, but I have not been able to do anything
   beyond installing the appropriate perl modules. If there are any
   instructions for this usage, I would appreciate it.
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   40
   :ID:       B8173D32-D7EB-4619-8488-B2C641431FDE
   :CREATED:  [2008-04-05 Sat]
   :END:
** WORKSFORME [#C] ledger -Mn
   - State "WORKSFORME" [2008-08-17 Sun 20:13]
   Is not the same as: ledger -M -n
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   126
   :ID:       2C3B5DCE-AB7F-41A2-BF93-56CC1222AE64
   :CREATED:  [2008-04-11 Fri]
   :END:
** INVALID Remove bogus reference to Emacs in project documentation (2.6)
   - State "INVALID"    [2008-07-13 Sun 22:16]
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   72
   :ID:       7455E4A7-16FD-4F41-8A33-CF44F6E690B2
   :CREATED:  [2008-04-11 Fri]
   :END:
** DUPLICATE [#A] Bug with date ranges
   - State "DUPLICATE"  [2008-04-04 Fri 14:35] \\
     This has been fixed, see the comments in #36.
   I'm using the latest source from CVS and it appears the `-e` option is
   broken.  For example this works as expected:
   :OUTPUT:
   % ledger -b 2006/05/01 bal
   :END:

   But this does not.  No output whatsoever:
   :OUTPUT:
   % ledger -b 2006/05/01 -e 2006/05/31 bal
   :END:

   This also doesn't work.  It just shows `Opening Balances: 0`:
   :OUTPUT:
   % ledger -p "last month" bal
   :END:
   :PROPERTIES:
   :Submitter: Eric Davis <edavis@insanum.com>
   :Version:  2.6
   :Ticket:   17
   :ID:       FE3E08C0-802A-4FAA-B8BA-93D81C061148
   :CREATED:  [2007-12-10 Mon]
   :END:
** DUPLICATE [#A] DOS format line endings are fooling the parser
   - State "DUPLICATE"  [2008-08-16 Sat 03:56] \\
     Duplicated by #43.
   The \r\n ending is having only the \n stripped, making the \r appear as part
   of the filename when doing a !include.
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   129
   :ID:       6DF2250F-C54D-4F67-AFB6-F8656020D394
   :CREATED:  [2008-04-11 Fri]
   :END:
** DUPLICATE Need to strip \r from \r\n line endings
   - State "DUPLICATE"  [2008-07-13 Sun 22:38]
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   139
   :ID:       C7A61E89-08D1-4151-AF2E-92F666148F19
   :CREATED:  [2008-04-11 Fri]
   :END:
** DUPLICATE Problems parsing an xact
   - State "DUPLICATE"  [2008-07-18 Fri 02:12]
   :OUTPUT:
   djw@hector:~$ ledger bal

   2007/03/07 Irena
   Liabilities:Cash:Irena 18.00 USD
   Liabilities:Order1:Irena -4 halfg
   Liabilities:Order1:Irena -1 gouda
   Error: /home/djw/milk.ledger, line 106: Xact above does not balance; remainder is: 18.00 USD
   -1 gouda
   -4 halfg
   :END:
   Here is what is in the prices.db file:
   :DATA:
   C 1.00 USD = $1.21
   P 2007/03/04 00:00:00 halfg 2.75 USD
   P 2007/03/04 00:00:00 gouda 7 USD
   :END:
   So you multiply 4*2.75 and add 7, you get 18.  Since the units are USD, what
   is the beef?  Why isn't ledger seeing 1 gouda and 4 halfg as 18 USD?
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   133
   :ID:       AD876FB0-E7B8-4C89-9E23-2D25AF8D5F0A
   :CREATED:  [2008-04-11 Fri]
   :END:
** TESTED [#A] Ledger fails to balance a simple xact
   - State "TESTED"     [2009-02-24 Tue 13:08]
   - State "DONE"       [2008-07-28 Mon 02:05] \\
     This was quite the nasty little bug.
   I just installed v2.6.1 and ledger reports errors with some posts
   that were fine with v2.5:
   :OUTPUT:
   [21:51:49 vinod]:~/src/ledger $ ledger --version
   Ledger 2.6.1, the command-line accounting tool

   [21:51:55 vinod]:~/src/ledger $ ledger bal
   While balancing xact:
   2007/02/02 RD VMMXX
     Assets:Investments:Vanguard:VMMXX  0.350 VMMXX @ $1.00
     Income:Dividends:Vanguard:VMMXX        $-0.35
   Unbalanced remainder is:
             $-0.35
   Error: "/home/vinod/data/ledger.dat", line 52379: Xact does not balance
   :END:
   :PROPERTIES:
   :Submitter: Vinod Kurup <vvkurup@gmail.com>
   :Version:  2.6.1b
   :Ticket:   205
   :ID:       0CA014F9-E309-4840-9085-71EC1F46DEC1
   :CREATED:  [2008-07-28 Mon]
   :END:
* Docs
** DONE Some at-signs are not properly escaped in documentation                          :ATTACH:
   - State "DONE"       [2008-03-27 Thu 19:42]
   Some of the at signs are not properly escaped in the texi
   documentation. This leads to great confusion when trying to figure out how
   to use commodity posts.
   :PROPERTIES:
   :Submitter: thedward <thedward@barsoom.net>
   :Version:  2.6
   :Ticket:   31
   :Attachments: ledger-texi.patch
   :ID:       A7CA0F5B-1F08-417A-9071-A223601100CA
   :CREATED:  [2008-01-28 Mon]
   :END:
** DONE [#C] Remove bogus reference to Emacs in project documentation
   - State "DONE"       [2008-07-16 Wed 03:59]
   The gnucash docs talk about there someday being an Emacs mode. There is
   already one.
   :PROPERTIES:
   :Submitter: bpt <#ledger>
   :Version:  2.4.1
   :Ticket:   10
   :ID:       B81ADF25-F176-4ABC-9C2B-1090E4F2FA7D
   :CREATED:  [2007-12-10 Mon]
   :END:
* Emacs
** DONE [#A] Marking a xact cleared may delete text in ledger-mode
   - State "DONE"       [2008-07-18 Fri 02:28]
   I started the groundwork for this, now I just have to add code to insert
   whitespace if needed to keep each xact valid.
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   70
   :ID:       0EB5602F-66BE-46C0-8A74-5EB5DBAF2E07
   :CREATED:  [2008-04-11 Fri]
   :END:
** DONE [#A] Reconciling is broken again; I need a way to verify Emacs output
   - State "DONE"       [2008-07-17 Thu 23:40] \\
     Reconciling is now line-based in 2.6.1, not character based (which has serious
     issues with UTF-8 at the moment).
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   64
   :ID:       7A8C49FB-F9B8-4ECF-8720-9E29559F3CA6
   :CREATED:  [2008-04-11 Fri]
   :END:
** DONE ledger.el requires an absolute pathname for the ledger-binary-path
   - State "DONE"       [2008-07-17 Thu 22:09]
   This caused me pain after a ledger upgrade. "ledger" should be sufficient if
   it's in the path.
   :PROPERTIES:
   :Submitter: Simon Michael <simon@joyful.com>
   :Version:  2.6
   :Ticket:   199
   :ID:       7D40038A-DEED-47FA-8D02-0951E94CA175
   :CREATED:  [2008-07-12 Sat]
   :END:
** DUPLICATE Reconciling doesn't work in ledger.el
   - State "DUPLICATE"  [2008-07-16 Wed 03:56] \\
     Duplicated by #64.
   I've tried version 2.5 but have had some problems.

   I use Carbon Emacs on Mac OS X to edit my Ledger files.  Unfortunately the
   reconcile functionality doesn't work any more.  Pressing the space bar
   doesn't always toggle an xact, sometimes it needs to be pressed twice,
   sometimes it never goes.  Additionally, even if some posts are toggled,
   nothing is changed in the main file and pressing C-c C-c just re-sets the
   reconcile window back to it's original state.

   I've tried with and without the new ledger-clear-whole-posts variable set.
   :PROPERTIES:
   :Submitter: Karen Cooke <karen.cooke@gmail.com>
   :Version:  2.6
   :Ticket:   14
   :ID:       2B02E2FD-DCF8-4CD8-A7FA-F83F5DAE3F55
   :CREATED:  [2007-12-10 Mon]
   :END:
* Features
** DONE [#C] When reporting the unbalanced remainder, round it
   - State "DONE"       [2008-07-17 Thu 20:52]
   This is so that it shows what ledger is really thinking.
   :PROPERTIES:
   :Submitter: John Wiegley <johnw@newartisans.com>
   :Version:  2.6
   :Ticket:   125
   :ID:       4BF95CDC-972F-4F39-9F54-7BEFD404F9AA
   :CREATED:  [2008-04-11 Fri]
   :END:
